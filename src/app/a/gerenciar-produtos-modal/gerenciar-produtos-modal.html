<div class="modal-backdrop">
  <div class="modal-gerenciar-produtos">
    <div class="modal-header">
      <h2>Gerenciar Produtos</h2>
      <button
        class="btn-fechar"
        type="button"
        aria-label="Fechar modal"
        (click)="fechar.emit()"
      >
        ✕
      </button>
    </div>
    <div class="modal-body">
      <form #form="ngForm" class="gerenciar-produtos-form">
        <h3>
          {{
            modoFormulario() === "CRIAR"
              ? "Adicionar Produto"
              : "Editar Produto"
          }}
        </h3>
        <div class="form-group">
          <label for="nome">Nome</label>
          <input
            id="nome"
            name="nome"
            type="text"
            required
            [(ngModel)]="nome"
          />
        </div>
        <div class="form-group">
          <label for="preco">Preço</label>
          <input
            id="preco"
            name="preco"
            type="number"
            min="0"
            step="0.01"
            required
            [(ngModel)]="preco"
          />
        </div>
        <div class="form-group">
          <label for="unidade">Unidade</label>
          <select id="unidade" name="unidade" required [(ngModel)]="unidade">
            <option value="UN">UN</option>
            <option value="KG">KG</option>
            <option value="L">L</option>
            <option value="CX">CX</option>
            <option value="PCT">PCT</option>
          </select>
        </div>
        <div class="form-actions">
          <button
            class="btn-primario"
            type="button"
            [disabled]="form.invalid"
            (click)="confirmarProduto()"
          >
            {{
              modoFormulario() === "CRIAR" ? "Adicionar" : "Salvar Alterações"
            }}
          </button>

          @if(modoFormulario() === 'EDITAR') {
          <button
            type="button"
            class="btn-secundario"
            (click)="cancelarEdicao()"
          >
            Cancelar</button
          >}
        </div>
      </form>

      <div class="tabela-container">
        <table class="tabela-produtos">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nome</th>
              <th>Preço</th>
              <th>Unidade</th>
              <th>Ações</th>
            </tr>
          </thead>

          <tbody>
            @for (produto of produtosCadastrados(); track produto.id) {
            <tr
              (click)="editarProduto(produto)"
              [class.selecionado]="produto.id === produtoEmEdicao()?.id"
            >
              <td>{{ produto.id }}</td>
              <td>{{ produto.nome }}</td>
              <td>{{ produto.preco | currency : "BRL" }}</td>
              <td>{{ produto.unidade }}</td>
              <td>
                <button
                  type="button"
                  class="btn-remover"
                  (click)="remover.emit(produto.id!); $event.stopPropagation()"
                >
                  ❌
                </button>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
